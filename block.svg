<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="750" viewBox="0 0 1200 750">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#000" />
    </marker>
    <style type="text/css">
      <![CDATA[
        text { font-family: Helvetica, Arial, sans-serif; font-size: 14px; }
        .label { font-weight: bold; font-size: 16px; }
        .signal { font-style: italic; font-size: 14px; fill: #333; }
        .unit { font-size: 12px; fill: #666; }
        .block { fill: #f4f4f4; stroke: #333; stroke-width: 2px; }
        .plant-block { fill: #e1edff; stroke: #004a99; stroke-width: 2px; }
        .sensor-block { fill: #fff2cc; stroke: #d6b656; stroke-width: 2px; }
        .controller-block { fill: #ddf4dd; stroke: #38761d; stroke-width: 2px; }
        .process-block { fill: #fff; stroke: #333; stroke-width: 1.5px; stroke-dasharray: 5,2; }
        .sum { fill: #fff; stroke: #333; stroke-width: 2px; }
        line, path { stroke: #000; stroke-width: 1.5px; fill: none; marker-end: url(#arrow); }
        .dashed-line { stroke-dasharray: 6,4; }
        .boundary-line { stroke: #999; stroke-width: 1px; stroke-dasharray: 8,8; marker-end: none; }
        .boundary-text { font-size: 18px; font-weight: bold; fill: #999; }
      ]]>
    </style>
  </defs>

  <rect x="0" y="0" width="1200" height="750" fill="#ffffff"/>
  <line x1="50" y1="480" x2="1150" y2="480" class="boundary-line"/>
  <text x="60" y="470" class="boundary-text">Discrete-Time Controller (T_s = 8 ms)</text>
  <text x="60" y="505" class="boundary-text">Continuous-Time Plant &amp; Physics</text>

  <rect x="800" y="530" width="200" height="80" rx="5" ry="5" class="plant-block"/>
  <text x="900" y="565" text-anchor="middle" class="label">PLANT</text>
  <text x="900" y="585" text-anchor="middle">Stepper Motor +</text>
  <text x="900" y="600" text-anchor="middle">Rotary Arm &amp; Pendulum</text>

  <line x1="1000" y1="550" x2="1100" y2="550"/>
  <text x="1050" y="545" text-anchor="middle" class="signal">θ_p(t)</text>
  <line x1="1000" y1="590" x2="1100" y2="590"/>
  <text x="1050" y="585" text-anchor="middle" class="signal">θ_m(t)</text>


  <rect x="1040" y="360" width="120" height="60" rx="5" ry="5" class="sensor-block"/>
  <text x="1100" y="385" text-anchor="middle">Pendulum Sensor</text>
  <text x="1100" y="405" text-anchor="middle">(AS5600 + ZOH)</text>

  <rect x="1040" y="260" width="120" height="60" rx="5" ry="5" class="sensor-block"/>
  <text x="1100" y="285" text-anchor="middle">Motor Sensor</text>
  <text x="1100" y="305" text-anchor="middle">(AS5600 + ZOH)</text>

  <path d="M 1100 550 L 1130 550 L 1130 390 L 1160 390" marker-end="none" class="dashed-line"/>
  <line x1="1160" y1="390" x2="1165" y2="390"/> <path d="M 1100 590 L 1140 590 L 1140 290 L 1160 290" marker-end="none" class="dashed-line"/>
  <line x1="1160" y1="290" x2="1165" y2="290"/> <rect x="840" y="360" width="160" height="60" rx="5" ry="5" class="block"/>
  <text x="920" y="385" text-anchor="middle">Offset Correction &amp;</text>
  <text x="920" y="405" text-anchor="middle">Normalization</text>

  <rect x="840" y="260" width="160" height="60" rx="5" ry="5" class="block"/>
  <text x="920" y="285" text-anchor="middle">Offset Correction &amp;</text>
  <text x="920" y="305" text-anchor="middle">Sign Flip (-)</text>

  <line x1="1040" y1="390" x2="1000" y2="390"/>
  <line x1="1040" y1="290" x2="1000" y2="290"/>

  <line x1="840" y1="390" x2="780" y2="390"/>
  <text x="810" y="385" text-anchor="middle" class="signal">θ_p[k]</text>
  <text x="810" y="405" text-anchor="middle" class="unit">(deg)</text>

  <line x1="840" y1="290" x2="420" y2="290"/>
  <text x="650" y="285" text-anchor="middle" class="signal">θ_m[k]</text>
  <text x="650" y="305" text-anchor="middle" class="unit">(deg)</text>

  <rect x="620" y="400" width="140" height="60" rx="5" ry="5" class="block"/>
  <text x="690" y="425" text-anchor="middle">Derivative Est.</text>
  <text x="690" y="445" text-anchor="middle">&amp; LPF (α=0.2)</text>
  <path d="M 780 390 L 780 430 L 760 430"/>
  <line x1="620" y1="430" x2="550" y2="430"/>
  <text x="585" y="425" text-anchor="middle" class="signal">θ̇_p[k]</text>
  <text x="585" y="445" text-anchor="middle" class="unit">(deg/s)</text>


  <rect x="240" y="260" width="180" height="60" rx="5" ry="5" class="controller-block"/>
  <text x="330" y="285" text-anchor="middle">Deadzone (|θ|>10°)</text>
  <text x="330" y="305" text-anchor="middle">&amp; Gain (-Kp_center)</text>

  <rect x="240" y="180" width="120" height="40" rx="5" ry="5" class="block"/>
  <text x="300" y="205" text-anchor="middle">Saturation (±5°)</text>

  <line x1="240" y1="290" x2="200" y2="290" marker-end="none"/>
  <path d="M 200 290 L 200 200 L 240 200"/>

  <text x="180" y="190" class="signal">Bias</text>


  <text x="60" y="155" class="signal">Upright Ref</text>
  <text x="60" y="175" class="label">0°</text>
  <circle cx="120" cy="165" r="20" class="sum"/>
  <text x="120" y="170" text-anchor="middle" font-size="20">+</text>
  <text x="120" y="140" text-anchor="middle" font-size="20" fill="#999">+</text>

  <line x1="80" y1="165" x2="100" y2="165"/> <path d="M 360 200 L 390 200 L 390 110 L 120 110 L 120 145"/> <text x="200" y="155" class="signal">θ_p*[k]</text>
  <text x="200" y="175" class="unit">(Desired)</text>

  <circle cx="280" cy="390" r="20" class="sum"/>
  <text x="255" y="395" text-anchor="middle" font-size="20">-</text>
  <text x="280" y="420" text-anchor="middle" font-size="20">+</text>

  <path d="M 140 165 L 280 165 L 280 365" /> <path d="M 780 390 L 300 390" /> <text x="315" y="380" class="signal">e[k]</text>
  <text x="315" y="400" class="unit">(deg)</text>

  <line x1="300" y1="390" x2="340" y2="390" marker-end="none"/>
  <path d="M 340 390 L 340 330 L 360 330"/> <path d="M 340 390 L 340 410 L 360 410"/> <rect x="360" y="310" width="60" height="40" rx="5" ry="5" class="controller-block"/>
  <text x="390" y="335" text-anchor="middle">Kp</text>

  <rect x="360" y="390" width="100" height="40" rx="5" ry="5" class="controller-block"/>
  <text x="410" y="410" text-anchor="middle">Integrator</text>
  <text x="410" y="425" text-anchor="middle">(Clamp ±15)</text>
  <rect x="480" y="390" width="60" height="40" rx="5" ry="5" class="controller-block"/>
  <text x="510" y="415" text-anchor="middle">Ki</text>
  <line x1="460" y1="410" x2="480" y2="410"/>

  <path d="M 550 430 L 530 430 L 530 470 L 510 470"/>
  <rect x="410" y="450" width="100" height="40" rx="5" ry="5" class="block"/>
  <text x="460" y="475" text-anchor="middle">Clamp (±200)</text>
  <rect x="330" y="450" width="60" height="40" rx="5" ry="5" class="controller-block"/>
  <text x="360" y="475" text-anchor="middle">-Kd</text>
  <line x1="410" y1="470" x2="390" y2="470"/>

  <circle cx="580" cy="370" r="25" class="sum"/>
  <text x="560" y="375" text-anchor="middle" font-size="20">+</text>
  <text x="580" y="405" text-anchor="middle" font-size="20">+</text>
  <text x="580" y="340" text-anchor="middle" font-size="20">+</text>

  <path d="M 420 330 L 580 330 L 580 345"/> <path d="M 540 410 L 580 410 L 580 395"/> <path d="M 330 470 L 310 470 L 310 510 L 580 510 L 580 395"/> <text x="615" y="365" class="signal">u[k]</text>
  <text x="615" y="385" class="unit">(deg-equiv)</text>


  <line x1="605" y1="370" x2="640" y2="370"/>
  <rect x="640" y="340" width="100" height="60" rx="5" ry="5" class="block"/>
  <text x="690" y="365" text-anchor="middle">Gain</text>
  <text x="690" y="385" text-anchor="middle">1 / 0.225</text>
  <text x="690" y="405" text-anchor="middle" class="unit">(steps/deg)</text>

  <text x="750" y="365" class="signal">ω_cmd[k]</text>
  <text x="750" y="385" class="unit">(steps/s)</text>

  <line x1="740" y1="370" x2="780" y2="370"/>
  <rect x="780" y="340" width="140" height="60" rx="5" ry="5" class="block"/>
  <text x="850" y="365" text-anchor="middle">Saturation</text>
  <text x="850" y="385" text-anchor="middle">(±MAX_HZ)</text>

  <line x1="920" y1="370" x2="960" y2="370"/>
  <rect x="960" y="340" width="140" height="60" rx="5" ry="5" class="block"/>
  <text x="1030" y="365" text-anchor="middle">Soft Limits</text>
  <text x="1030" y="385" text-anchor="middle">(Brake based on θ_m)</text>
  <path d="M 600 290 L 1030 290 L 1030 340" class="dashed-line"/>


  <line x1="1100" y1="370" x2="1150" y2="370" marker-end="none"/>
  <path d="M 1150 370 L 1150 570 L 1000 570"/>

  <text x="1120" y="490" text-anchor="middle" class="signal">Stepper Speed</text>
  <text x="1120" y="510" text-anchor="middle" class="signal">Command</text>
  <text x="1120" y="530" text-anchor="middle" class="unit">Hz + Dir (ZOH)</text>

  <text x="600" y="50" text-anchor="middle" font-size="24" font-weight="bold">Rotary Inverted Pendulum Control System Diagram</text>
  <text x="600" y="80" text-anchor="middle" font-size="18" fill="#666">Cascade Control: Inner PID (Pendulum Stabilization) + Outer Bias (Base Centering)</text>

</svg>