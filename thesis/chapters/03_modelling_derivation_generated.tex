% AUTO-GENERATED FILE â€” DO NOT EDIT.
% Generated from tools/modelling_complete.md by tools/build_modelling_chapter.py

\section{Definition}\label{definition}

Generalized coordinates:

\(\theta(t)\): arm yaw angle.

\(\alpha(t)\): pendulum angle, with \(\alpha=0\) upright.

Constants:

\(L_r\): arm length (motor axis to pendulum pivot axis).

\(L_h\): horizontal length of the L-shaped pendulum (pivot shaft segment).

\(L_v\): vertical length of the L-shaped pendulum (swinging segment).

\(m_p\): swinging mass.

\(l_p\): distance from pivot axis to pendulum COM (of the swinging mass).

\(g\): gravity.

\(\tau\): actuation torque about \(\theta\).

Geometry note (this rig): the pendulum is an \textbf{L-shaped rod}. The horizontal segment is aligned with the arm (radial direction) and forms a bearing-supported pivot shaft (three 688RS bearings). The vertical segment carries most of the swinging mass and swings in the \((\mathbf e_t,\mathbf k)\) plane.

In the reduced model used for control, \(m_p\) and \(l_p\) refer to the mass distribution that moves with \(\alpha\) (vertical segment plus concentrated mass). The horizontal segment lies on the pivot axis and contributes primarily to arm-side inertia.

Define

\[K \equiv m_p L_r l_p,\qquad G \equiv m_p g l_p\]

These grouped constants are introduced for compactness: \(G\) appears when collecting gravity potential/torque terms, and \(K\) appears when collecting inertial coupling terms between arm rotation and pendulum swing.

Let

\(\hat J_1\): yaw inertia about motor axis (arm-side).

\(\hat J_2\): pendulum pivot inertia (about the pivot axis).

\(J_p\): pendulum inertia about its center of mass, about an axis perpendicular to the swing plane. \[\hat J_0 \triangleq \hat J_1 + m_p L_r^2\]

The definition of \(\hat J_0\) follows from collecting the \(\dot{\theta}^2\) terms in the kinetic energy: it is the arm-side yaw inertia about the motor axis plus the parallel-axis contribution of the swinging mass at radius \(L_r\).

Rigid links; frictionless joints.

A schematic of the coordinates and parameters is shown in Fig.~\ref{fig:furuta_schematic}.

\begin{figure}[htbp]
  \centering
  \begin{tikzpicture}[
    x={(0.78cm,-0.45cm)},
    y={(1.00cm,0.00cm)},
    z={(0.00cm,1.00cm)},
    line cap=round,
    line join=round,
  ]
    \pgfmathsetmacro{\thetad}{35}
    \pgfmathsetmacro{\alphad}{25}
    \def\Lr{4.2}
    \def\lp{3.0}
    \def\Rtheta{1.2}
    \def\Ralpha{1.1}

    \coordinate (O) at (0,0,0);
    \coordinate (P) at ({\Lr*cos(\thetad)},{\Lr*sin(\thetad)},0);
    \coordinate (B) at ({\Lr*cos(\thetad) - \lp*sin(\alphad)*sin(\thetad)},
                        {\Lr*sin(\thetad) + \lp*sin(\alphad)*cos(\thetad)},
                        {\lp*cos(\alphad)});

    % Axes.
    \draw[-{Latex[length=3mm]}] (O) -- (3.2,0,0) node[below left] {$x$};
    \draw[-{Latex[length=3mm]}] (O) -- (0,3.4,0) node[below] {$y$};
    \draw[-{Latex[length=3mm]}] (O) -- (0,0,3.4) node[left] {$z$};

    % Base yaw angle theta (in xy plane).
    \draw[-{Latex[length=3mm]}]
      plot[domain=0:\thetad, samples=30]
        ({\Rtheta*cos(\x)},{\Rtheta*sin(\x)},0)
      node[pos=0.65, right] {$\theta$};

    % Arm.
    \draw[line width=1.2pt] (O) -- (P) node[pos=0.55, above] {$L_r$};
    \fill (O) circle (0.06);
    \fill (P) circle (0.06);

    % Upright reference at the pendulum pivot.
    \draw[dashed] (P) -- ++(0,0,3.2);

    % Pendulum.
    \draw[line width=1.2pt] (P) -- (B) node[pos=0.55, right] {$l_p$};
    \fill (B) circle (0.14);
    \node[above] at (B) {$m_p$};

    % Pendulum angle alpha (in the (e_t, z) plane).
    \draw[-{Latex[length=3mm]}]
      plot[domain=0:\alphad, samples=25]
        ({\Lr*cos(\thetad) - \Ralpha*sin(\x)*sin(\thetad)},
         {\Lr*sin(\thetad) + \Ralpha*sin(\x)*cos(\thetad)},
         {\Ralpha*cos(\x)})
      node[pos=0.65, right] {$\alpha$};
  \end{tikzpicture}
  \caption{Rotary (Furuta) inverted pendulum schematic and generalized coordinates used in this chapter.}
  \label{fig:furuta_schematic}
\end{figure}
\FloatBarrier

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Parameter evaluation}\label{parameter-evaluation}

Formal parameter identification methods for Furuta pendulum rigs (including fitting inertia/friction terms from data) are well documented; see, e.g., \cite{GarciaAlarcon2012}.

Given:

\[L_r=0.19\ \mathrm{m},\quad m_r=0.051\ \mathrm{kg}\] \[L_h=0.17\ \mathrm{m},\quad L_v=0.12\ \mathrm{m}\] \[m_{\mathrm{rod,total}}=10.3\ \mathrm{g}=0.0103\ \mathrm{kg}\] \[m_s=7.7\ \mathrm{g}=0.0077\ \mathrm{kg},\quad x_s=0.103\ \mathrm{m}\]

Linear density:

\[\lambda = \frac{10.3\ \mathrm{g}}{290\ \mathrm{mm}}=0.03552\ \mathrm{g/mm}\]

Mass split:

\[m_h = 170\lambda = 6.04\ \mathrm{g}=0.006038\ \mathrm{kg}\] \[m_{\mathrm{rod}} = 120\lambda = 4.26\ \mathrm{g}=0.004262\ \mathrm{kg}\]

Swinging mass:

\[m_p = m_{\mathrm{rod}}+m_s = 0.011962069\ \mathrm{kg}\]

COM distance:

\[x_{\mathrm{rod}}=\frac{L_v}{2}=0.06\ \mathrm{m}\] \[l_p = \frac{m_{\mathrm{rod}}x_{\mathrm{rod}}+m_s x_s}{m_p}\] \[l_p = \frac{(0.004262)(0.06) + (0.0077)(0.103)}{0.011962069}\] \[l_p = \frac{2.5572\times 10^{-4} + 7.931\times 10^{-4}}{0.011962069} = 0.087679158\ \mathrm{m}\]

Pendulum pivot inertia (rod about end + sphere point mass):

\[I_{\mathrm{rod,piv}} = \frac{1}{3}m_{\mathrm{rod}}L_v^2 = \frac{1}{3}(0.004262)(0.12^2)=2.045793103\times 10^{-5}\] \[I_{\mathrm{s,piv}} = m_s x_s^2 = (0.0077)(0.103^2)=8.16893\times 10^{-5}\] \[\hat J_2 = I_{\mathrm{rod,piv}}+I_{\mathrm{s,piv}} = 1.021472310\times 10^{-4}\ \mathrm{kg\,m^2}\]

Gravity constant:

\[G=m_p g l_p=(0.011962069)(9.81)(0.087679158)=1.028896479\times 10^{-2}\ \mathrm{N\,m}\]

Coupling constant:

\[K=m_p L_r l_p=(0.011962069)(0.19)(0.087679158)=1.992765862\times 10^{-4}\ \mathrm{kg\,m^2}\]

Arm-side yaw inertia:

\[\hat J_0=\hat J_1+m_pL_r^2\]

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Kinematics}\label{kinematics}

Let \(\{\mathbf i,\mathbf j,\mathbf k\}\) be an inertial orthonormal basis. Define the planar arm basis

\[\mathbf e_r \equiv \cos\theta\,\mathbf i + \sin\theta\,\mathbf j,\qquad \mathbf e_t \equiv -\sin\theta\,\mathbf i + \cos\theta\,\mathbf j\]

Pendulum pivot position:

\[\mathbf r_h = L_r\mathbf e_r\]

Pendulum COM relative to pivot:

\[\mathbf r_{p/h}=l_p\bigl(\sin\alpha\,\mathbf e_t + \cos\alpha\,\mathbf k\bigr)\]

Pendulum COM position:

\[\mathbf r_p = \mathbf r_h + \mathbf r_{p/h}\]

Components \(\mathbf r_p = x\mathbf i+y\mathbf j+z\mathbf k\):

\[x = L_r\cos\theta - l_p\sin\alpha\,\sin\theta\] \[y = L_r\sin\theta + l_p\sin\alpha\,\cos\theta\] \[z = l_p\cos\alpha\]

Derivatives:

\[\frac{d}{dt}(\cos\theta)=-\sin\theta\,\dot\theta,\quad \frac{d}{dt}(\sin\theta)=\cos\theta\,\dot\theta\] \[\frac{d}{dt}(\sin\alpha)=\cos\alpha\,\dot\alpha,\quad \frac{d}{dt}(\cos\alpha)=-\sin\alpha\,\dot\alpha\]

\subsection{Velocity components}\label{velocity-components}

For \(x\):

\[\dot x = \frac{d}{dt}(L_r\cos\theta) - l_p\frac{d}{dt}(\sin\alpha\,\sin\theta)\] \[\frac{d}{dt}(L_r\cos\theta)=-L_r\sin\theta\,\dot\theta\] \[\frac{d}{dt}(\sin\alpha\,\sin\theta)=(\cos\alpha\,\dot\alpha)\sin\theta + \sin\alpha(\cos\theta\,\dot\theta)\] \[\dot x = -L_r\sin\theta\,\dot\theta - l_p\cos\alpha\sin\theta\,\dot\alpha - l_p\sin\alpha\cos\theta\,\dot\theta\]

For \(y\):

\[\dot y = \frac{d}{dt}(L_r\sin\theta) + l_p\frac{d}{dt}(\sin\alpha\,\cos\theta)\] \[\frac{d}{dt}(L_r\sin\theta)=L_r\cos\theta\,\dot\theta\] \[\frac{d}{dt}(\sin\alpha\,\cos\theta)=(\cos\alpha\,\dot\alpha)\cos\theta + \sin\alpha(-\sin\theta\,\dot\theta)\] \[\dot y = L_r\cos\theta\,\dot\theta + l_p\cos\alpha\cos\theta\,\dot\alpha - l_p\sin\alpha\sin\theta\,\dot\theta\]

For \(z\):

\[\dot z = \frac{d}{dt}(l_p\cos\alpha)=-l_p\sin\alpha\,\dot\alpha\]

\subsection{Speed squared}\label{speed-squared}

Compute \(v^2=\dot x^2+\dot y^2+\dot z^2\).

Define

\[A=L_r\sin\theta + l_p\sin\alpha\cos\theta,\quad B=l_p\cos\alpha\sin\theta\] \[C=L_r\cos\theta - l_p\sin\alpha\sin\theta,\quad D=l_p\cos\alpha\cos\theta\]

Then

\[\dot x = -A\dot\theta - B\dot\alpha,\qquad \dot y = C\dot\theta + D\dot\alpha,\qquad \dot z = -l_p\sin\alpha\,\dot\alpha\]

Square:

\[\dot x^2 = A^2\dot\theta^2 + B^2\dot\alpha^2 + 2AB\dot\theta\dot\alpha\] \[\dot y^2 = C^2\dot\theta^2 + D^2\dot\alpha^2 + 2CD\dot\theta\dot\alpha\] \[\dot z^2 = l_p^2\sin^2\alpha\,\dot\alpha^2\]

Collect \(\dot\theta^2\):

\[A^2+C^2 = (L_r\sin\theta + l_p\sin\alpha\cos\theta)^2 + (L_r\cos\theta - l_p\sin\alpha\sin\theta)^2\]

Expand:

\[\begin{aligned}
A^2 &= L_r^2\sin^2\theta + l_p^2\sin^2\alpha\cos^2\theta + 2L_r l_p\sin\alpha\sin\theta\cos\theta,\\
C^2 &= L_r^2\cos^2\theta + l_p^2\sin^2\alpha\sin^2\theta - 2L_r l_p\sin\alpha\sin\theta\cos\theta.
\end{aligned}\]

Add:

\[A^2+C^2 = L_r^2(\sin^2\theta+\cos^2\theta) + l_p^2\sin^2\alpha(\sin^2\theta+\cos^2\theta)=L_r^2+l_p^2\sin^2\alpha\]

Collect \(\dot\alpha^2\):

\[B^2+D^2+ l_p^2\sin^2\alpha = l_p^2\cos^2\alpha(\sin^2\theta+\cos^2\theta)+l_p^2\sin^2\alpha=l_p^2\]

Collect \(\dot\theta\dot\alpha\):

\[AB+CD = l_p\cos\alpha\Big[(L_r\sin\theta + l_p\sin\alpha\cos\theta)\sin\theta + (L_r\cos\theta - l_p\sin\alpha\sin\theta)\cos\theta\Big]\]

Expand bracket:

\[\begin{aligned}
&(L_r\sin\theta + l_p\sin\alpha\cos\theta)\sin\theta + (L_r\cos\theta - l_p\sin\alpha\sin\theta)\cos\theta\\
&=L_r(\sin^2\theta+\cos^2\theta)+l_p\sin\alpha(\cos\theta\sin\theta-\sin\theta\cos\theta)=L_r.
\end{aligned}\]

Thus

\[AB+CD = L_r l_p\cos\alpha\]

Therefore

\[v^2=(L_r^2+l_p^2\sin^2\alpha)\dot\theta^2 + l_p^2\dot\alpha^2 + 2L_r l_p\cos\alpha\,\dot\theta\dot\alpha\]

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Energies}\label{energies}

Translational kinetic energy:

\[T_{\mathrm{trans}}=\frac{1}{2}m_p v^2\]

Rotational kinetic energy of the pendulum about its COM (perpendicular axis):

\[T_{\mathrm{rot}}=\frac{1}{2}J_p(\dot\alpha^2+\sin^2\alpha\,\dot\theta^2)\]

Parallel axis:

\[\hat J_2 = J_p + m_p l_p^2\]

Arm yaw kinetic energy:

\[T_{\mathrm{arm}}=\frac{1}{2}\hat J_1\dot\theta^2\]

Total kinetic energy:

\[T=T_{\mathrm{arm}}+T_{\mathrm{trans}}+T_{\mathrm{rot}}\]

Collect terms.

Coefficient of \(\dot\theta^2\):

\[\frac{1}{2}\Big[\hat J_1+m_pL_r^2+(m_pl_p^2+J_p)\sin^2\alpha\Big]\dot\theta^2
=\frac{1}{2}(\hat J_0+\hat J_2\sin^2\alpha)\dot\theta^2\]

Coefficient of \(\dot\alpha^2\):

\[\frac{1}{2}(m_pl_p^2+J_p)\dot\alpha^2=\frac{1}{2}\hat J_2\dot\alpha^2\]

Cross term:

\[m_pL_r l_p\cos\alpha\,\dot\theta\dot\alpha = K\cos\alpha\,\dot\theta\dot\alpha\]

Thus

\[T=\frac{1}{2}(\hat J_0+\hat J_2\sin^2\alpha)\dot\theta^2 + \frac{1}{2}\hat J_2\dot\alpha^2 + K\cos\alpha\,\dot\theta\dot\alpha\]

Potential energy:

\[V=m_p g z = m_p g l_p\cos\alpha = G\cos\alpha\]

Lagrangian:

\[\mathcal L=T-V\]

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Euler--Lagrange equations}\label{eulerlagrange-equations}

\[\frac{d}{dt}\left(\frac{\partial\mathcal L}{\partial\dot q}\right)-\frac{\partial\mathcal L}{\partial q}=Q\]

\[Q_\theta=\tau,\qquad Q_\alpha=0\]

\subsection{\texorpdfstring{Equation in \(\theta\)}{Equation in \textbackslash theta}}\label{equation-in-theta}

\[\frac{\partial\mathcal L}{\partial\dot\theta}=(\hat J_0+\hat J_2\sin^2\alpha)\dot\theta + K\cos\alpha\,\dot\alpha\]

Differentiate:

\[\frac{d}{dt}\left[(\hat J_0+\hat J_2\sin^2\alpha)\dot\theta\right]=(\hat J_0+\hat J_2\sin^2\alpha)\ddot\theta + \hat J_2\frac{d}{dt}(\sin^2\alpha)\dot\theta\]

\[\frac{d}{dt}(\sin^2\alpha)=2\sin\alpha\cos\alpha\,\dot\alpha=\sin(2\alpha)\dot\alpha\]

\[\frac{d}{dt}(K\cos\alpha\,\dot\alpha)=K\left(-\sin\alpha\,\dot\alpha^2+\cos\alpha\,\ddot\alpha\right)\]

Also \(\partial\mathcal L/\partial\theta=0\).

Thus

\[ (\hat J_0+\hat J_2\sin^2\alpha)\ddot\theta + K\cos\alpha\,\ddot\alpha + \hat J_2\sin(2\alpha)\dot\theta\dot\alpha - K\sin\alpha\,\dot\alpha^2 = \tau\]

\subsection{\texorpdfstring{Equation in \(\alpha\)}{Equation in \textbackslash alpha}}\label{equation-in-alpha}

\[\frac{\partial\mathcal L}{\partial\dot\alpha}=\hat J_2\dot\alpha + K\cos\alpha\,\dot\theta\]

Differentiate:

\[\frac{d}{dt}\left(\hat J_2\dot\alpha\right)=\hat J_2\ddot\alpha\] \[\frac{d}{dt}(K\cos\alpha\,\dot\theta)=K\left(-\sin\alpha\,\dot\alpha\dot\theta+\cos\alpha\,\ddot\theta\right)\]

Partial derivative:

\[\frac{\partial\mathcal L}{\partial\alpha}=\frac{1}{2}\hat J_2\frac{\partial}{\partial\alpha}(\sin^2\alpha)\dot\theta^2 - K\sin\alpha\,\dot\theta\dot\alpha + G\sin\alpha\] \[\frac{\partial}{\partial\alpha}(\sin^2\alpha)=\sin(2\alpha)\]

Thus

\[\frac{\partial\mathcal L}{\partial\alpha}=\frac{1}{2}\hat J_2\sin(2\alpha)\dot\theta^2 - K\sin\alpha\,\dot\theta\dot\alpha + G\sin\alpha\]

Euler--Lagrange (\(Q_\alpha=0\)):

\[\hat J_2\ddot\alpha + K\cos\alpha\,\ddot\theta - K\sin\alpha\,\dot\alpha\dot\theta - \left(\frac{1}{2}\hat J_2\sin(2\alpha)\dot\theta^2 - K\sin\alpha\,\dot\theta\dot\alpha + G\sin\alpha\right)=0\]

Cancel the \(\pm K\sin\alpha\,\dot\theta\dot\alpha\) terms:

\[K\cos\alpha\,\ddot\theta + \hat J_2\ddot\alpha - \frac{1}{2}\hat J_2\sin(2\alpha)\dot\theta^2 - G\sin\alpha = 0\]

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Nonlinear model}\label{nonlinear-model}

\[ (\hat J_0+\hat J_2\sin^2\alpha)\ddot\theta + K\cos\alpha\,\ddot\alpha + \hat J_2\sin(2\alpha)\dot\theta\dot\alpha - K\sin\alpha\,\dot\alpha^2 = \tau\]

\[K\cos\alpha\,\ddot\theta + \hat J_2\ddot\alpha - \frac{1}{2}\hat J_2\sin(2\alpha)\dot\theta^2 - G\sin\alpha = 0\]

The derived equations are structurally consistent with classical Furuta pendulum models \cite{Cazzolato2011}, with the distinction that actuator dynamics are treated at the acceleration level rather than torque level.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{\texorpdfstring{Linearization about upright (\(\alpha\approx 0\))}{Linearization about upright (\textbackslash alpha\textbackslash approx 0)}}\label{linearization-about-upright-alphaapprox-0}

\[\sin\alpha\approx \alpha,\qquad \cos\alpha\approx 1,\qquad \sin(2\alpha)\approx 2\alpha\]

Neglect products of small quantities.

Linear model:

\[\hat J_0\ddot\theta + K\ddot\alpha = \tau\] \[K\ddot\theta + \hat J_2\ddot\alpha - G\alpha = 0\]

Solve for \(\ddot\alpha\):

\[\ddot\alpha = \frac{G}{\hat J_2}\alpha - \frac{K}{\hat J_2}\ddot\theta\]

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\section{Numerical specialization}\label{numerical-specialization}

Let \(J_0\equiv \hat J_0\) and \(J_1\equiv \hat J_2\). Numerical values:

\[J_0=0.001104\ \mathrm{kg\,m^2},\quad J_1=1.021\times 10^{-4}\ \mathrm{kg\,m^2},\quad K=1.993\times 10^{-4}\ \mathrm{kg\,m^2},\quad G=0.01029\ \mathrm{N\,m}\]

Linear equations:

\[J_0\ddot\theta + K\ddot\alpha = \tau\] \[K\ddot\theta + J_1\ddot\alpha - G\alpha = 0\]

Reduced relation:

\[\ddot\alpha = \frac{G}{J_1}\alpha - \frac{K}{J_1}\ddot\theta\]

Numerically:

\[\ddot\alpha = 100.8\,\alpha - 1.952\,\ddot\theta\]

Open-loop fall rate (\(\tau=0\)). From \(\ddot\theta=-(K/J_0)\ddot\alpha\):

\[\left(J_1-\frac{K^2}{J_0}\right)\ddot\alpha - G\alpha = 0\]

\[J_{eq}=J_1-\frac{K^2}{J_0}=0.0001021-\frac{(0.0001993)^2}{0.001104}=6.612\times 10^{-5}\]

\[\ddot\alpha = \frac{G}{J_{eq}}\alpha,\qquad \lambda=\pm\sqrt{\frac{G}{J_{eq}}}=\pm 12.47\ \mathrm{rad/s}\]

Mass matrix inverse:

\[M=\begin{bmatrix}J_0 & K\\K & J_1\end{bmatrix},\qquad M^{-1}=\frac{1}{J_0J_1-K^2}\begin{bmatrix}J_1 & -K\\-K & J_0\end{bmatrix}\]

\[J_0J_1-K^2=7.2998\times 10^{-8}\]

\[M^{-1}=\begin{bmatrix}1398.7 & -2730.2\\-2730.2 & 15123.7\end{bmatrix}\]

Substituted form:

\[0.001104\,\ddot\theta + 0.0001993\,\ddot\alpha = \tau\] \[0.0001993\,\ddot\theta + 0.0001021\,\ddot\alpha - 0.01029\,\alpha = 0\]

Nonlinear model with numerical constants:

\[ (J_0+J_1\sin^2\alpha)\ddot\theta + K\cos\alpha\,\ddot\alpha + J_1\sin(2\alpha)\dot\theta\dot\alpha - K\sin\alpha\,\dot\alpha^2 = \tau\]

\[K\cos\alpha\,\ddot\theta + J_1\ddot\alpha - \frac{1}{2}J_1\sin(2\alpha)\dot\theta^2 - G\sin\alpha = 0\]

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}
