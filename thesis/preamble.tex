\usepackage[margin=1in]{geometry}
\usepackage{microtype}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}

\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,calc}

\usepackage{booktabs}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{siunitx}

% Non-SI unit used throughout this project (stepper command units).
\DeclareSIUnit{\step}{step}

% Optional: provides \FloatBarrier for predictable float placement.
% BasicTeX (minimal TeX Live) may not include this package.
\IfFileExists{placeins.sty}{%
  \usepackage{placeins}%
}{%
  \providecommand{\FloatBarrier}{}%
}

\usepackage{hyperref}

% Float placement tuning: reduce awkward whitespace and keep figures/tables near
% where they are discussed without overusing rigid [H] placement.
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\renewcommand{\topfraction}{0.90}
\renewcommand{\bottomfraction}{0.80}
\renewcommand{\textfraction}{0.08}
\renewcommand{\floatpagefraction}{0.85}

% Bibliography (IEEE numeric style).
% BasicTeX may not ship biblatex by default; we fall back to a minimal
% BibTeX bibliography so the thesis still compiles. Install with tlmgr for IEEE style:
%   tlmgr install biblatex biblatex-ieee
\IfFileExists{biblatex.sty}{%
  \usepackage[backend=biber,style=ieee]{biblatex}
  \addbibresource{bib/references.bib}
  \newcommand{\ThesisPrintBibliography}{\printbibliography}
}{%
  % Fallback: BibTeX + IEEE numeric style (available in BasicTeX).
  \newcommand{\ThesisPrintBibliography}{%
    \bibliographystyle{ieeetr}%
    \bibliography{bib/references}%
  }%
}

% Pandoc sometimes emits \tightlist; define it as a no-op.
\providecommand{\tightlist}{}

% ----------------- Figure helpers (PDF preferred; PNG fallback; placeholder if missing) -----------------
\newcommand{\IncludeGraphicAuto}[2]{%
  \IfFileExists{#1.pdf}{%
    \includegraphics[width=#2]{#1.pdf}%
  }{%
    \IfFileExists{#1.png}{%
      \includegraphics[width=#2]{#1.png}%
    }{%
      \fbox{\parbox{0.95\linewidth}{Missing figure: \texttt{#1.(pdf|png)}}}%
    }%
  }%
}

\newcommand{\ThesisFigure}[4]{%
  \begin{figure}[htbp]
    \centering
    \IncludeGraphicAuto{#1}{#4}
    \caption{#2}
    \label{#3}
  \end{figure}
}

\newcommand{\InputIfExists}[2]{%
  \IfFileExists{#1}{\input{#1}}{#2}%
}

% ----------------- Controller "mini conclusions" box -----------------
\newcommand{\ObservedBox}[1]{%
  \begin{center}
    \fbox{\parbox{0.95\linewidth}{\textbf{Observed behavior (HOLD/NUDGE/TAP).}~#1}}
  \end{center}
}

% Units (siunitx) defaults.
\sisetup{
  detect-all,
  group-digits = integer,
  group-separator = {,},
  group-minimum-digits = 4
}
